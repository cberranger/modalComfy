<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>FLUX.1 Modal Inference UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body x-data="fluxUI()">
    <div class="max-w-2xl mx-auto py-8 px-4">
      <h2 class="text-3xl font-bold text-center mb-8">FLUX.1 Inference UI</h2>
      <form @submit.prevent="submit" class="space-y-4 bg-white p-6 rounded shadow">
        <div>
          <label class="block font-medium">Prompt</label>
          <input type="text" x-model="form.prompt" class="w-full border rounded px-3 py-2" required />
        </div>
        <div>
          <label class="block font-medium">Prompt 2</label>
          <input type="text" x-model="form.prompt2" class="w-full border rounded px-3 py-2" />
        </div>
        <div>
          <label class="block font-medium">Negative Prompt</label>
          <input type="text" x-model="form.negative_prompt" class="w-full border rounded px-3 py-2" />
        </div>
        <div>
          <label class="block font-medium">Negative Prompt 2</label>
          <input type="text" x-model="form.negative_prompt2" class="w-full border rounded px-3 py-2" />
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block font-medium">True CFG Scale</label>
            <input type="number" x-model.number="form.true_cfg_scale" min="0" max="20" step="0.1" class="w-full border rounded px-3 py-2" />
          </div>
          <div class="flex-1">
            <label class="block font-medium">Guidance Scale</label>
            <input type="number" x-model.number="form.guidance_scale" min="0" max="20" step="0.1" class="w-full border rounded px-3 py-2" />
          </div>
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block font-medium">Height</label>
            <input type="number" x-model.number="form.height" min="256" max="1024" step="16" class="w-full border rounded px-3 py-2" />
          </div>
          <div class="flex-1">
            <label class="block font-medium">Width</label>
            <input type="number" x-model.number="form.width" min="256" max="1024" step="16" class="w-full border rounded px-3 py-2" />
          </div>
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block font-medium">Steps</label>
            <input type="number" x-model.number="form.steps" min="1" max="50" class="w-full border rounded px-3 py-2" />
          </div>
          <div class="flex-1">
            <label class="block font-medium">Num Images</label>
            <input type="number" x-model.number="form.num_images" min="1" max="4" class="w-full border rounded px-3 py-2" />
          </div>
        </div>
        <div>
          <label class="block font-medium">Seed</label>
          <input type="number" x-model.number="form.seed" class="w-full border rounded px-3 py-2" />
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block font-medium">Output Format</label>
            <select x-model="form.output_format" class="w-full border rounded px-3 py-2">
              <option value="PNG">PNG</option>
              <option value="JPG">JPG</option>
              <option value="WEBP">WEBP</option>
            </select>
          </div>
          <div class="flex-1">
            <label class="block font-medium">Output Quality</label>
            <input type="number" x-model.number="form.output_quality" min="1" max="100" class="w-full border rounded px-3 py-2" />
          </div>
        </div>
        <button type="submit" class="w-full bg-black text-white py-2 rounded font-semibold" :disabled="loading">
          <span x-show="!loading">Generate</span>
          <span x-show="loading">Generating...</span>
        </button>
      </form>
      <div class="mt-8" x-show="images.length > 0">
        <h3 class="text-xl font-semibold mb-4">Generated Images</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <template x-for="url in images" :key="url">
            <div>
              <img :src="url" class="rounded shadow w-full" />
              <a :href="url" target="_blank" class="block text-blue-600 mt-2 text-sm break-all">Open image</a>
            </div>
          </template>
        </div>
      </div>
    </div>
    <script>
      function fluxUI() {
        return {
          form: {
            prompt: "",
            prompt2: "",
            negative_prompt: "",
            negative_prompt2: "",
            true_cfg_scale: 1.0,
            height: 1024,
            width: 1024,
            steps: 28,
            guidance_scale: 3.5,
            num_images: 1,
            seed: null,
            output_format: "PNG",
            output_quality: 90,
          },
          loading: false,
          images: [],
          async submit() {
            this.loading = true;
            this.images = [];
            try {
              const res = await fetch("https://chris-22--flux-endpoint-fluxservice-inference-dev.modal.run", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(this.form),
              });
              if (!res.ok) throw new Error("Inference failed");
              const urls = await res.json();
              this.images = urls;
            } catch (e) {
              alert("Error: " + e.message);
            } finally {
              this.loading = false;
            }
          },
        };
      }
    </script>
  </body>
</html>
